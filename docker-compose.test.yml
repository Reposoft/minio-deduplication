version: '2.4'
services:

  minio0:
    image: minio/minio:RELEASE.2020-08-18T19-41-00Z@sha256:3c70874018b496021bf4a9719a78ed0dc3f08fc8ad49813184849be5e309e1e5
    command:
    - server
    - /data
    expose:
    - 9000
    mem_limit: 20000000

  app0:
    depends_on:
    - minio0
    build:
      context: .
    command:
    - --host=minio0:9000
    - --secure=false
    - --accesskey=minioadmin
    - --secretkey=minioadmin
    - --inbox=bucket.write
    - --archive=bucket.read
    #- --trace=true
    mem_limit: 20000000

  sut:
    depends_on:
    - minio0
    - app0
    build: ./tests
    environment:
    - DEBUG=true
    - MINIO_ACCESS_KEY=minioadmin
    - MINIO_SECRET_KEY=minioadmin
    entrypoint:
    - all.sh
